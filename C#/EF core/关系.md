### 单向导航

```

 builder.Entity<Bok>(b =>
        {
            b.ToTable("FP_Boks");
            b.Property(x => x.Name).IsRequired().HasMaxLength(128);
            b.HasOne(x => x.bookRel)
            // 另一边没有导航可以添加WithOne()或者WithMany()表示
            .WithOne()
            // 通过泛型BookRel自定义指定外键，没有EF core会通过类型名称+Id创建外键
            .HasForeignKey<BookRel>(b => b.BokId)
            // 不使用级联
            .OnDelete(DeleteBehavior.ClientSetNull);
        });
```

### 多对多导航

#### 方式一：

```c#
// Department
public class Department : Entity<Guid>
{
    public Department()
    {
    }
    public Department(Guid Id, Guid tenantId, Guid pid, string dptCode, string dptName) : base(Id)
    {
        TenantId = tenantId;
        Pid = pid;
        DptCode = dptCode;
        DptName = dptName;
    }
    public Guid TenantId { get; set; }
    public Guid Pid { get; set; }
    public String DptCode { get; set; }
    public String DptName { get; set; }
    public List<User> Users { get; set; }
    public List<DptUserRel> DptUserRels { get; set; }
 }

// DptUserRel
public class DptUserRel : Entity
{
    public Guid DptId { get; set; }
    public Guid UserId { get; set; }
    public override object[] GetKeys()
    {
        return new object[] { DptId, UserId };
    }
    public User User { get; set; }
    public Department Department { get; set; }
}

// User
public class User : Entity<Guid>
{
    public Guid TenantId { get; set; }
    public String UserDisplayName { get; set; }
    public String UserEmail { get; set; }
    public String UserMobile { get; set; }
    public bool UserEnabled { get; set; }
    public bool UserSync { get; set; }
    public String UserBuildinName { get; set; }
    public String UserBuildinPassword { get; set; }
    public String UserAdName { get; set; }
    public String UserAadName { get; set; }
    public String UserWeworkName { get; set; }
    public String UserDingtalkName { get; set; }
    public String UserFeishuName { get; set; }
    public List<Department> Departments { get; set; }
    public List<DptUserRel> DptUserRels { get; set; }
}


// OnModelCreating -> 部门、用户、部门及用户关系
builder.Entity<DptUserRel>(b => {
    b.ToTable("Sys_DptUserRel");
    b.HasKey(c => new { c.DptId, c.UserId });
    b.RemoeForeignKey("DptId");
    b.RemoeForeignKey("UserId");
});

builder.Entity<User>(b =>
{
    b.ConfigureByConvention();
    b.ToTable("Sys_User");
    b.HasMany(x => x.Departments)
     .WithMany(x => x.Users)
     .UsingEntity<DptUserRel>(x => {
        x.HasOne(o => o.User).WithMany(m => m.DptUserRels)
         .HasForeignKey(f => f.UserId);

        x.HasOne(o => o.Department).WithMany(m => m.DptUserRels)
         .HasForeignKey(f => f.DptId);
    });
});

builder.Entity<Department>(b =>
{
    b.ConfigureByConvention();
    b.ToTable("Sys_Department");
});
```

#### 方式二：(间接多对多关系)

```c#
// Post
public class Post
{
    public int PostId { get; set; }
    public string Title { get; set; }
    public string Content { get; set; }

    public List<PostTag> PostTags { get; set; }
}

// Tag
public class Tag
{
    public string TagId { get; set; }

    public List<PostTag> PostTags { get; set; }
}

// PostTag
public class PostTag
{
    public DateTime PublicationDate { get; set; }

    public int PostId { get; set; }
    public Post Post { get; set; }

    public string TagId { get; set; }
    public Tag Tag { get; set; }
}

// OnModelCreating
public class MyContext : DbContext
{
    public MyContext(DbContextOptions<MyContext> options)
        : base(options)
    {
    }

    public DbSet<Post> Posts { get; set; }
    public DbSet<Tag> Tags { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<PostTag>()
            .HasKey(t => new { t.PostId, t.TagId });

        modelBuilder.Entity<PostTag>()
            .HasOne(pt => pt.Post)
            .WithMany(p => p.PostTags)
            .HasForeignKey(pt => pt.PostId);

        modelBuilder.Entity<PostTag>()
            .HasOne(pt => pt.Tag)
            .WithMany(t => t.PostTags)
            .HasForeignKey(pt => pt.TagId);
    }
}
```

